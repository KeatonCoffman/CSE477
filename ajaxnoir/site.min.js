/*! ajaxnoir 2017-06-28 */

function Login(e){var t=$(e);t.submit(function(a){a.preventDefault(),console.log("Submitted"),$.ajax({url:"post/login.php",data:t.serialize(),method:"POST",success:function(t){var a=parse_json(t);a.ok?window.location.assign("./"):$(e+" .message").html("<p>"+a.message+"</p>")},error:function(t,a,i){$(e+" .message").html("<p>Error: "+i+"</p>")}})})}function MovieInfo(e,t,a){console.log("MovieInfo: "+t+"/"+a);$(e);var i=this;$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"db62a3c333da11376d4113727bae6842",query:t,year:a},method:"GET",dataType:"text",success:function(t){var a=parse_json(t);0==a.total_results?$(".paper").html("<p>No information available</p>"):i.printInfo(e,a.results[0])},error:function(e,t,a){$(".paper").html("<p>Unable to connect to database</p>")}})}function parse_json(e){try{var t=$.parseJSON(e)}catch(t){throw"JSON parse error: "+e}return t}function Stars(e){console.log(e);for(var t=$(e+" table").find("tr"),a=1;a<t.length;a++)for(var i=$(t.get(a)),o=i.find('input[name="id"]').val(),s=i.find("img"),n=0;n<s.length;n++){var r=$(s.get(n));this.installListener(e,i,r,o,n+1)}}MovieInfo.prototype.printInfo=function(e,t){console.log(t);var a="<ul><li id='info'><a href='#'><img src='images/info.png'></a><div class='show'>";a+="<h1>Title: "+t.title+"</h1>",a+="<p>Release Date: "+t.release_date+"</p>",a+="<p>Vote Average: "+t.vote_average+"</p>",a+="<p>Vote Count: "+t.vote_count+"</p>",a+="</div></li>",a+="<li id='plot'><a href='#'><img src='images/plot.png'></a><div>",a+="<p>"+t.overview+"</p>",a+="</div></li>",a+="<li id='poster'><a href='#'><img src='images/poster.png'></a>",a+="<div><p class='poster'><img id='poster' src=''></p>",a+="</div></li></ul>",$(e).html(a),$("img#poster").attr("src","http://image.tmdb.org/t/p/w500/"+t.poster_path),$(document).ready(function(){$("li#info > a").click(function(){$("ul > li > a > img").css("opacity",.3),$("li#plot > div").fadeOut(1e3),$("li#poster > div").fadeOut(1e3),$("li#info > div").fadeIn(1e3)}),$("li#poster > a").click(function(){$("ul > li > a > img").css("opacity",.3),$("li#info > div").fadeOut(1e3),$("li#plot > div").fadeOut(1e3),$("li#poster > div").fadeIn(1e3)}),$("li#plot > a").click(function(){$("ul > li > a > img").css("opacity",.3),$("li#info > div").fadeOut(1e3),$("li#poster > div").fadeOut(1e3),$("li#plot > div").fadeIn(1e3)})})},Stars.prototype.installListener=function(e,t,a,i,o){var s=this;a.click(function(){console.log("Click on "+i+" rating: "+o),$.ajax({url:"post/stars.php",data:{id:i,rating:o},method:"POST",success:function(a){var i=parse_json(a);i.ok?(s.update(t,o),s.message("<p>Successfully updated</p>"),s.updateTable(i.table),new Stars(e)):s.message("<p>Update failed</p>")},error:function(e,t,a){s.message("<p>Error: "+a+"</p>")}})})},Stars.prototype.update=function(e,t){for(var a=e.find("img"),i=0;i<a.length;i++){var o=$(a.get(i));i<t?o.attr("src","images/star-green.png"):o.attr("src","images/star-gray.png")}e.find("span.num").text(t+"/10")},Stars.prototype.message=function(e){console.log("message envoked"),$(" .messages").html(e).show().delay(2e3).fadeIn(1e3).fadeOut(1e3)},Stars.prototype.updateTable=function(e){$("table").html(e)};